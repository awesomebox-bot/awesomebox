#!/usr/bin/env node

var open = require('open')
  , async = require('async')
  , awesomebox = require('../');

var opts = require('nopt')({
  watch: Boolean,
  'hunt-port': Boolean,
  port: String
}, {
  p: '--port'
}, process.argv);

if (!opts.watch) opts.watch = true;
if (!opts['hunt-port']) opts['hunt-port'] = true;
if (process.env.PORT && !opts.port) opts.port = process.env.PORT;

console.log(opts);

var server = new awesomebox.Server(opts);

async.series([
  function(cb) { server.initialize(cb); },
  function(cb) { server.configure(cb); },
  function(cb) { server.start(cb); }
], function(err) {
  if (err) {
    console.log(err.stack);
    process.exit(1);
  }
  
  console.log('[awesomebox] Listening on port ' + server.address.port);
  open('http://' + server.address.address + ':' + server.address.port + '/')
});
